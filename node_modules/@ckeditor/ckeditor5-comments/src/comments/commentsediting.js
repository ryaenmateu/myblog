/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x9d13=['collaboration.channelId','model','elementToElement','comment:','isObject','top','getAllMarkersForId','high','ck-comment-marker--active','change:activeMarker','getWalker','activeMarker','for','sort','split','ck-comment-marker','affectsData','createRange','conversion','destroy','upcast','view','newRange','markers','delete','editor','ready','text','updateMarker','size','isThreadsLoadingPaused','pluginName','map','length','hasMarkerForId','hasContent','_changedMarkers','change:isReadOnly','destroyed','stop','differ','end','from','update:comment','$graveyard','_threads','low','addCommentThread','createElement','markerToData','listenTo','start','get','render','config','getCommentThreads','comment','getCommentThread','CommentsRepository','removeMarker','removeCommentThread','data','isEqual','getAttribute','registerPostFixer','add','push','document','plugins','set','dataDowncast','fetchCommentThread','managedUsingOperations','editing','_detachCommentThread','once','left','name','switchReadOnly','init','isCollapsed','root','state','change','change:isThreadsLoadingPaused'];(function(_0x42fcdb,_0x9d13a5){const _0x4fbe5f=function(_0x5e6e01){while(--_0x5e6e01){_0x42fcdb['push'](_0x42fcdb['shift']());}};_0x4fbe5f(++_0x9d13a5);}(_0x9d13,0x17d));const _0x4fbe=function(_0x42fcdb,_0x9d13a5){_0x42fcdb=_0x42fcdb-0x0;let _0x4fbe5f=_0x9d13[_0x42fcdb];return _0x4fbe5f;};import _0x49aefe from'@ckeditor/ckeditor5-core/src/plugin';import _0x52ecb8 from'@ckeditor/ckeditor5-utils/src/dom/rect';import _0x5790fd from'./commentsrepository';import _0x3ab5e6 from'./addcommentthreadcommand';import _0x172e3a from'../utils/getmarkerdomelement';import _0x7c2f26 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class F extends _0x49aefe{static get['requires'](){return[_0x5790fd,_0x7c2f26];}static get[_0x4fbe('0x4b')](){return'CommentsEditing';}constructor(_0x2b1cc8){super(_0x2b1cc8),this[_0x4fbe('0x1c')](_0x4fbe('0x4a'),!0x0),_0x2b1cc8[_0x4fbe('0x14')][_0x4fbe('0x22')](_0x4fbe('0x46'),()=>this['isThreadsLoadingPaused']=!0x1),this[_0x4fbe('0x1c')]('activeMarker',null),this['on'](_0x4fbe('0x35'),(_0x307e27,_0x167711,_0x3fa7e7,_0x58d855)=>{_0x2b1cc8[_0x4fbe('0x2d')]['change'](_0x4aa902=>{if(_0x3fa7e7){const {id:_0x1f7cb2}=L(_0x3fa7e7),_0xb8223c=this['getAllMarkersForId'](_0x1f7cb2);for(const _0x1cdf3f of _0xb8223c)_0x4aa902[_0x4fbe('0x48')](_0x1cdf3f);}if(_0x58d855){const {id:_0x16d2f5}=L(_0x58d855),_0x1bdd53=this[_0x4fbe('0x32')](_0x16d2f5);for(const _0x259cb7 of _0x1bdd53)_0x4aa902[_0x4fbe('0x48')](_0x259cb7);}});}),this['X']=new Set();}[_0x4fbe('0x26')](){const _0x28e157=this[_0x4fbe('0x45')],_0x2b2179=_0x28e157[_0x4fbe('0x1b')][_0x4fbe('0xb')]('CommentsRepository'),_0x37590b=_0x28e157['config'][_0x4fbe('0xb')]('collaboration.channelId');_0x28e157['commands'][_0x4fbe('0x18')](_0x4fbe('0x6'),new _0x3ab5e6(_0x28e157)),this['listenTo'](_0x28e157,_0x4fbe('0x51'),(_0x1cf2f0,_0x5b5b51,_0x3d11a9)=>{_0x2b2179[_0x4fbe('0x25')](_0x3d11a9,_0x28e157[_0x4fbe('0xd')]['get'](_0x4fbe('0x2c')));}),this[_0x4fbe('0x9')](_0x2b2179,P(_0x4fbe('0x13'),_0x37590b),(_0x8ddec7,{threadId:_0x3b354a})=>{_0x28e157[_0x4fbe('0x2d')][_0x4fbe('0x2a')](_0x18d0c7=>{for(const _0x2780ea of this[_0x4fbe('0x32')](_0x3b354a))_0x18d0c7[_0x4fbe('0x12')](_0x2780ea);});const _0x4987d7=_0x2b2179['getCommentThread'](_0x3b354a);_0x2b2179['hasCommentThread'](_0x3b354a)&&!_0x4987d7[_0x4fbe('0x4d')]||_0x8ddec7[_0x4fbe('0x53')]();},{'priority':_0x4fbe('0x33')}),this[_0x4fbe('0x9')](_0x2b2179,P('addComment',_0x37590b),(_0x5500c0,{threadId:_0x179206,isFromAdapter:_0x865dcc})=>{const _0x322635=this[_0x4fbe('0x32')](_0x179206);if(_0x865dcc||0x0==_0x322635[_0x4fbe('0x4d')]||!_0x2b2179['hasCommentThread'](_0x179206))return;0x1===_0x2b2179[_0x4fbe('0x10')](_0x179206)['length']&&_0x28e157['model']['change'](_0x434f11=>{for(const _0x315753 of _0x322635)_0x434f11[_0x4fbe('0x48')](_0x315753,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x4fbe('0x5')}),this['Y'](),this['Z']();}[_0x4fbe('0x3f')](){const _0x2630c2=this[_0x4fbe('0x45')][_0x4fbe('0x1b')][_0x4fbe('0xb')](_0x4fbe('0x11')),_0x3c7907=this[_0x4fbe('0x45')][_0x4fbe('0xd')][_0x4fbe('0xb')](_0x4fbe('0x2c'));for(const _0x4f54a2 of _0x2630c2[_0x4fbe('0xe')]({'channelId':_0x3c7907}))_0x2630c2['_detachCommentThread'](_0x4f54a2['id']),_0x2630c2[_0x4fbe('0x4')][_0x4fbe('0x44')](_0x4f54a2['id']);super['destroy']();}[_0x4fbe('0x4e')](_0x3cb6d0){return this[_0x4fbe('0x32')](_0x3cb6d0)[_0x4fbe('0x4d')]>0x0;}['getAllMarkersForId'](_0x2f4a20){const _0xb6a412=this['editor'][_0x4fbe('0x2d')][_0x4fbe('0x43')][_0x4fbe('0xb')](_0x4fbe('0x2f')+_0x2f4a20);return _0xb6a412?[_0xb6a412]:Array[_0x4fbe('0x1')](this['editor'][_0x4fbe('0x2d')][_0x4fbe('0x43')]['getMarkersGroup'](_0x4fbe('0x2f')+_0x2f4a20));}['Y'](){const _0x577bf9=this[_0x4fbe('0x45')];_0x577bf9[_0x4fbe('0x3e')][_0x4fbe('0x38')]('editingDowncast')['markerToHighlight']({'model':_0x4fbe('0xf'),'view':_0x418ff1=>{const {id:_0x3f173b}=L(_0x418ff1['markerName']),_0x25c3d5=[_0x4fbe('0x3b')];return this[_0x4fbe('0x37')]&&L(this[_0x4fbe('0x37')])['id']===_0x3f173b&&_0x25c3d5[_0x4fbe('0x19')](_0x4fbe('0x34')),{'classes':_0x25c3d5,'attributes':{'data-comment':_0x3f173b}};}}),_0x577bf9[_0x4fbe('0x3e')]['for'](_0x4fbe('0x1d'))[_0x4fbe('0x8')]({'model':_0x4fbe('0xf'),'view':_0x25bab7=>{const _0x151122=_0x577bf9[_0x4fbe('0x2d')][_0x4fbe('0x43')][_0x4fbe('0xb')](_0x25bab7),{id:_0x4e8164,part:_0x4e11a5}=L(_0x25bab7);return _0x151122[_0x4fbe('0x3c')]?{'group':_0x4fbe('0xf'),'name':_0x4e11a5?_0x4e8164+':'+_0x4e11a5:_0x4e8164}:null;}}),_0x577bf9[_0x4fbe('0x3e')][_0x4fbe('0x38')](_0x4fbe('0x40'))[_0x4fbe('0x2e')]({'view':{'name':_0x4fbe('0xf'),'attribute':{'id':/^\w/}},'model':(_0x5737af,_0x413ae3)=>_0x413ae3[_0x4fbe('0x7')]('$marker',{'data-name':'comment:'+_0x5737af[_0x4fbe('0x16')]('id')})}),_0x577bf9[_0x4fbe('0x3e')][_0x4fbe('0x38')](_0x4fbe('0x40'))['dataToMarker']({'view':'comment'});}['Z'](){const _0x2846b4=this[_0x4fbe('0x45')],_0x590746=_0x2846b4[_0x4fbe('0x1b')][_0x4fbe('0xb')](_0x4fbe('0x11')),_0x2ad31e=new Set();_0x2846b4[_0x4fbe('0x2d')][_0x4fbe('0x1a')][_0x4fbe('0x17')](_0x57218e=>{let _0x3750d6=!0x1;for(const [_0xc58ce1,_0x3a30f8]of _0x2846b4[_0x4fbe('0x2d')][_0x4fbe('0x1a')][_0x4fbe('0x54')][_0x4fbe('0x50')]){const {group:_0x538d04,id:_0x28ca4a}=L(_0xc58ce1);let _0x3d86be=_0x3a30f8[_0x4fbe('0x42')];if(_0x4fbe('0xf')!==_0x538d04||!_0x3d86be)continue;const _0xb50aa1=_0x4fbe('0x3')===_0x3d86be[_0x4fbe('0x28')]['rootName'];_0xb50aa1||(_0x3d86be=Q(_0x3d86be,_0x2846b4[_0x4fbe('0x2d')]),!_0x3d86be||_0x3d86be[_0x4fbe('0x15')](_0x3a30f8[_0x4fbe('0x42')]))?!_0x3d86be||!_0x2846b4[_0x4fbe('0x2d')][_0x4fbe('0x4f')](_0x3d86be)||this['X']['has'](_0x28ca4a)&&_0xb50aa1?(_0x57218e['removeMarker'](_0xc58ce1),_0x3750d6=!0x0):_0xb50aa1||(this['isThreadsLoadingPaused']?_0x2ad31e['add'](_0x28ca4a):this['tt'](_0x28ca4a)):(_0x57218e[_0x4fbe('0x48')](_0xc58ce1,{'range':_0x3d86be}),_0x3750d6=!0x0);}return _0x3750d6;}),this['on'](_0x4fbe('0x2b'),(_0x1f1920,_0x105cb3,_0x216bc3)=>{if(!_0x216bc3&&_0x2ad31e[_0x4fbe('0x49')])for(const _0xde0fc5 of _0x2ad31e)this['tt'](_0xde0fc5),_0x2ad31e[_0x4fbe('0x44')](_0xde0fc5);}),this[_0x4fbe('0x9')](_0x2846b4[_0x4fbe('0x2d')]['markers'],_0x4fbe('0x2'),(_0x3d10c8,_0x2ec86a,_0x21748f,_0x37cef1)=>{if(_0x37cef1)return;const {id:_0x309bcb}=L(_0x2ec86a[_0x4fbe('0x24')]),_0x524336=_0x2846b4[_0x4fbe('0x1b')][_0x4fbe('0xb')](_0x4fbe('0x11'))[_0x4fbe('0x10')](_0x309bcb);_0x2ad31e[_0x4fbe('0x44')](_0x309bcb),_0x524336&&!this[_0x4fbe('0x4e')](_0x309bcb)&&(this['X'][_0x4fbe('0x44')](_0x309bcb),_0x590746[_0x4fbe('0x21')](_0x309bcb));});}['tt'](_0x45ac88){if(this['X']['has'](_0x45ac88))return;this['X'][_0x4fbe('0x18')](_0x45ac88);const _0x17087b=this['editor'],_0x13a8e3=_0x17087b[_0x4fbe('0x1b')]['get'](_0x4fbe('0x11')),_0x3d373a=_0x17087b[_0x4fbe('0xd')][_0x4fbe('0xb')](_0x4fbe('0x2c')),_0x151185=()=>{const _0x432b41=this[_0x4fbe('0x32')](_0x45ac88);if(0x0==_0x432b41[_0x4fbe('0x4d')])return null;const _0x1d63c8=_0x432b41[_0x4fbe('0x4c')](_0x362c22=>_0x172e3a(_0x17087b[_0x4fbe('0x20')],_0x362c22));return _0x1d63c8[_0x4fbe('0x39')]((_0x1388c3,_0x439e1b)=>{const _0x26db8f=new _0x52ecb8(_0x1388c3),_0x313b88=new _0x52ecb8(_0x439e1b),_0x3fca02=_0x26db8f[_0x4fbe('0x31')]-_0x313b88[_0x4fbe('0x31')];return 0x0==_0x3fca02?_0x26db8f[_0x4fbe('0x23')]-_0x313b88['left']:_0x3fca02;}),_0x1d63c8[0x0];};!this[_0x4fbe('0x32')](_0x45ac88)[0x0][_0x4fbe('0x1f')]?_0x17087b[_0x4fbe('0x20')][_0x4fbe('0x41')][_0x4fbe('0x22')](_0x4fbe('0xc'),()=>{_0x13a8e3['openNewCommentThread']({'channelId':_0x3d373a,'threadId':_0x45ac88,'target':_0x151185});},{'priority':_0x4fbe('0x5')}):_0x13a8e3[_0x4fbe('0x1e')]({'channelId':_0x3d373a,'threadId':_0x45ac88})['then'](_0x4bc72a=>{if(_0x4fbe('0x52')!==_0x17087b[_0x4fbe('0x29')])if(_0x4bc72a)_0x4bc72a['attachTo'](_0x151185);else{const _0x2a5226=this[_0x4fbe('0x32')](_0x45ac88);_0x17087b[_0x4fbe('0x2d')][_0x4fbe('0x2a')](_0x180607=>{for(const _0x415339 of _0x2a5226)_0x180607['removeMarker'](_0x415339);});}});}}function P(_0x4a7856,_0x41d348){return _0x41d348?_0x4a7856+':'+_0x41d348:_0x4a7856;}function L(_0x3408a2){const _0x4fcdb7=_0x3408a2[_0x4fbe('0x3a')](':');return{'group':_0x4fcdb7[0x0],'id':_0x4fcdb7[0x1],'part':_0x4fcdb7[0x2]};}function Q(_0x3875b8,_0x4af54a){const _0x4d1568=_0x4af54a['schema'],_0x8dc211=_0x4af54a[_0x4fbe('0x3d')](_0x3875b8[_0x4fbe('0xa')]);for(const _0x2b76e2 of _0x3875b8[_0x4fbe('0x36')]()){const {type:_0x38e248,item:_0x224cf4,nextPosition:_0x1155eb}=_0x2b76e2;if(_0x4fbe('0x47')===_0x38e248||_0x4d1568[_0x4fbe('0x30')](_0x224cf4)){const _0x80cca=_0x4af54a['createPositionBefore'](_0x224cf4);_0x8dc211['isCollapsed']&&(_0x8dc211['start']=_0x80cca),_0x8dc211[_0x4fbe('0x0')]=_0x1155eb;}}return _0x8dc211[_0x4fbe('0x27')]?null:_0x8dc211;}