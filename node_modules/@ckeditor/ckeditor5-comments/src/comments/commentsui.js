/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x433b7f from'@ckeditor/ckeditor5-core/src/plugin';import _0x4ff4ab from'../annotations/annotations';import _0x43af55 from'./commentsrepository';import _0x4ccba6 from'./commentsediting';import _0x5767ac from'../annotations/editorannotations';import _0x449bc9 from'@ckeditor/ckeditor5-ui/src/button/buttonview';import _0x13cfd0 from'../../theme/icons/add-comment.svg';export default class G extends _0x433b7f{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x4ff4ab,_0x43af55,_0x4ccba6,_0x5767ac];}['init'](){const _0x3cc4eb=this['editor'],_0x43af7f=_0x3cc4eb['plugins']['get']('CommentsRepository'),_0xab91d5=_0x3cc4eb['plugins']['get']('CommentsEditing'),_0x4e8ba3=_0x3cc4eb['plugins']['get']('Annotations'),_0x3ed4d0=_0x3cc4eb['plugins']['get']('EditorAnnotations');_0x3cc4eb['ui']['componentFactory']['add']('comment',()=>this['ct']()),_0x3ed4d0['addSourceCollector'](()=>{const _0x4ea888=[];for(const [_0x254392,_0x3c3f80]of _0x43af7f['_threadToController']){const _0x654a4b=_0xab91d5['getAllMarkersForId'](_0x254392['id']),_0x5476d3=_0x654a4b['map'](_0x16929e=>_0x16929e['getRange']());_0x654a4b['length']>0x0&&_0x4ea888['push']([_0x3c3f80['view'],_0x5476d3]);}return _0x4ea888;}),this['listenTo'](_0x4e8ba3,'change:activeView',(_0xdd2d8a,_0x561a70,_0x39974e)=>{if(!_0x43af7f['_viewToController']['has'](_0x39974e))return void(_0xab91d5['activeMarker']=null);const _0x306d5d=_0x43af7f['_viewToController']['get'](_0x39974e)['model']['id'],_0x14d76d='comment:'+_0x306d5d;_0xab91d5['hasMarkerForId'](_0x306d5d)&&_0xab91d5['activeMarker']!=_0x14d76d?_0xab91d5['activeMarker']=_0x14d76d:_0xab91d5['activeMarker']&&(_0xab91d5['activeMarker']=null);}),this['listenTo'](_0x43af7f,'removeCommentThread',(_0x3969d5,{threadId:_0x572b16,isFromAdapter:_0x2ca967})=>{!_0x2ca967&&_0x3cc4eb['ui']['focusTracker']['isFocused']&&_0xab91d5['hasMarkerForId'](_0x572b16)&&_0x3cc4eb['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x43af7f,'addComment',(_0x1e097a,{threadId:_0x43491a,isFromAdapter:_0x1c05c7})=>{if(_0x1c05c7||!_0xab91d5['hasMarkerForId'](_0x43491a)||!_0x43af7f['hasCommentThread'](_0x43491a))return;0x1===_0x43af7f['getCommentThread'](_0x43491a)['length']&&(_0x3cc4eb['editing']['view']['focus'](),_0x1e097a['stop']());},{'priority':'low'});}['ct'](){const _0xf236f4=this['editor'],_0x31e095=new _0x449bc9(_0xf236f4['locale']),_0x49fdb7=_0xf236f4['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x31e095['label']=t('Comment'),_0x31e095['tooltip']=t('Comment'),_0x31e095['icon']=_0x13cfd0,_0x31e095['bind']('isEnabled')['to'](_0x49fdb7),this['listenTo'](_0x31e095,'execute',()=>_0x49fdb7['execute']()),_0x31e095;}}